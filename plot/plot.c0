#define _DEFAULT_SOURCE
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include "../helpers/helpers.h"
#include "../state/state.h"
#include "../mainheaders.h"

void plot(void* source, char* type) {
	printf("Plotting data\n");
	char* dpath = "pltdata.txt";
	char* template = "python3.9 plot.py %s";
	int length = snprintf(NULL, 0, template, dpath);
	char* buffer = calloc(length+1, sizeof(char));
	sprintf(buffer, template, dpath);
	char* ex = "python3.9";
	if (streq(type, "state")) {
		FILE* fptr = fopen(dpath, "w");
		write_array(((state*) source) -> data, fptr);
		fclose(fptr);

		//FILE* p = popen(buffer, "r");
		//int status = pclose(p);
		//
		execlp(ex, ex, "plot/plot.py", dpath, (char*) 0);
	} else if (streq(type, "array")) {
		FILE* fptr = fopen(dpath, "w");
		write_array(*((array*) source), fptr);
		fclose(fptr);
		execlp(ex, ex, "plot/plot.py", dpath, (char*) 0);
	} else {
		//assert(0, "invalid type");
	}
	free(buffer);
}
